{% extends 'mainbase.html' %}
{% load static %}

{% block content %}
<main>
  <h2>My Bookings ğŸ¨</h2>

  {% if messages %}
    <div class="messages">
      {% for m in messages %}
        <div class="msg {{ m.tags }}">{{ m }}</div>
      {% endfor %}
    </div>
  {% endif %}

  <div class="bookings-container">
    {% if bookings %}
      {% for booking in bookings %}
        <div class="booking-card">
          {% if booking.image_url %}
            <img src="{{ booking.image_url }}"
                 alt="{{ booking.room_name }}"
                 class="booking-image"
                 onerror="this.onerror=null;this.src='{% static 'images/default_hotel.jpg' %}';">
          {% else %}
            <img src="{% static 'images/default_hotel.jpg' %}"
                 alt="{{ booking.room_name }}"
                 class="booking-image">
          {% endif %}

          <div class="booking-info">
            <h3>{{ booking.room_name }}</h3>
            <p>ğŸ“… Check-in: <strong>{{ booking.checkin }}</strong> â€¢ Check-out: <strong>{{ booking.checkout }}</strong></p>
            <p>ğŸ‘¤ Persons: <strong>{{ booking.persons }}</strong> â€¢ ğŸ’° Price: <strong>â‚¹{{ booking.price }}</strong></p>

            <div class="booking-actions">
              {% if booking.paid %}
                <span class="paid-badge">Paid âœ…</span>
              {% else %}
                <form method="post" action="{% url 'pay_now' booking.id %}" style="display:inline">
                  {% csrf_token %}
                  <button type="submit" class="pay-btn">ğŸ’³ Pay Now</button>
                </form>
              {% endif %}

              <form method="post" action="{% url 'delete_booking' booking.id %}" style="display:inline">
                {% csrf_token %}
                <button type="submit" class="delete-btn" onclick="return confirm('Delete this booking?');">ğŸ—‘ï¸ Delete</button>
              </form>
            </div>
          </div>
        </div>
      {% endfor %}
    {% else %}
      <p class="no-bookings-msg">You have no bookings yet.</p>
    {% endif %}
  </div>
</main>

<link rel="stylesheet" href="{% static 'css/bookings.css' %}">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
{% endblock %}
